<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Islamic Poster Generator</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üåô Daily Islamic Poster Generator</h1>
            <p>Penjana Poster Islamik Harian - Mudah & Pantas</p>
        </div>

        <div class="content">
            <!-- Get Data Button -->
            <div class="section">
                <h3><span class="icon">‚è∞</span>Langkah 1: Dapatkan Data Harian</h3>
                <div style="text-align: center;">
                    <button class="btn btn-main" onclick="getAllData()">
                        üìä Dapatkan Semua Data Hari Ini
                    </button>
                </div>
                <div id="loading" class="loading">
                    <div class="spinner"></div>
                    <p>Sedang mengumpulkan data...</p>
                </div>
                <div id="current-datetime" class="current-datetime hidden"></div>
            </div>

            <!-- Prayer Times -->
            <div id="prayer-section" class="section hidden">
                <h3><span class="icon">üïå</span>Waktu Solat Hari Ini</h3>
                <div id="prayer-times" class="prayer-times"></div>
            </div>

            <!-- Hadith Selection -->
            <div id="hadith-section" class="section hidden">
                <h3><span class="icon">üìñ</span>Pilih Hadis</h3>
                <div id="hadith-choices"></div>
            </div>

            <!-- Doa Selection -->
            <div id="doa-section" class="section hidden">
                <h3><span class="icon">ü§≤</span>Pilih Doa</h3>
                <div id="doa-choices"></div>
            </div>

            <!-- Illustration Selection -->
            <div id="illustration-section" class="section hidden">
                <h3><span class="icon">üé®</span>Pilih Ilustrasi</h3>
                <div id="illustration-choices"></div>
            </div>

            <!-- Generate Prompt -->
            <div id="generate-section" class="section hidden">
                <h3><span class="icon">‚ú®</span>Jana Prompt AI</h3>
                <div style="text-align: center;">
                    <button class="btn" onclick="generatePrompt()">
                        ü§ñ Jana Prompt AI
                    </button>
                </div>
                <p style="margin-top: 15px; color: #7f8c8d; font-style: italic; text-align: center;">
                    Copy maklumat dibawah dan paste pada ChatGPT atau Copilot. Ubah gaya illustrasi mengikut pilihan.
                </p>
            </div>
			<!-- Generate Prompt -->
            <div id="generate-section" class="section hidden">
                <h3><span class="icon">‚ú®</span>Jana Prompt AI</h3>
                <div style="text-align: center;">
                    <button class="btn" onclick="generatePrompt()">
                        ü§ñ Jana Prompt AI
                    </button>
                </div>
                <p style="margin-top: 15px; color: #7f8c8d; font-style: italic; text-align: center;">
                    Copy maklumat dibawah dan paste pada ChatGPT atau Copilot. Ubah gaya illustrasi mengikut pilihan.
                </p>
                
                <!-- Mobile Apps Download Section -->
                <div class="apps-download">
                    <h4 style="text-align: center; margin: 20px 0 15px 0; color: #2c3e50;">üì± Download Mobile Apps</h4>
                    <div class="apps-container">
                        <a href="https://apps.apple.com/app/chatgpt/id6448311069" target="_blank" class="app-link">
                            <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/0/04/ChatGPT_logo.svg/512px-ChatGPT_logo.svg.png" alt="ChatGPT Logo" class="app-logo">
                            <div class="app-info">
                                <div class="app-name">ChatGPT</div>
                                <div class="app-desc">iOS & Android</div>
                            </div>
                        </a>
                        
                        <a href="https://play.google.com/store/apps/details?id=com.microsoft.copilot" target="_blank" class="app-link">
                            <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/2/2a/Microsoft_365_Copilot_Icon.svg/512px-Microsoft_365_Copilot_Icon.svg.png" alt="Copilot Logo" class="app-logo">
                            <div class="app-info">
                                <div class="app-name">Microsoft Copilot</div>
                                <div class="app-desc">iOS & Android</div>
                            </div>
                        </a>
                    </div>
                </div>
            </div>

            <!-- AI Prompt Display -->
            <div id="prompt-section" class="hidden">
                <div class="prompt-container">
                    <h4 style="margin-bottom: 15px;">üìù Prompt AI untuk Poster:</h4>
                    <textarea id="prompt-textarea" class="prompt-textarea" placeholder="Prompt akan dipaparkan di sini..."></textarea>
                    <div class="prompt-actions">
                        <button class="btn btn-small" onclick="copyPrompt()">üìã Copy</button>
                        <button class="btn btn-small" onclick="editPrompt()">‚úèÔ∏è Edit</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentData = {
            datetime: null,
            hijriDate: null,
            prayerTimes: null,
            location: null,
            selectedHadith: null,
            selectedDoa: null,
            selectedIllustration: null
        };

        // Prayer time zones mapping
        const prayerZones = {
            "WLY01": { "name": "Kuala Lumpur", "state": "Wilayah Persekutuan", "lat": 3.1390, "lon": 101.6869 },
            "WLY02": { "name": "Putrajaya", "state": "Wilayah Persekutuan", "lat": 2.9264, "lon": 101.6964 },
            "WLY03": { "name": "Labuan", "state": "Wilayah Persekutuan", "lat": 5.2831, "lon": 115.2308 },
            "JHR01": { "name": "Johor Bahru, Kota Tinggi, Mersing", "state": "Johor", "lat": 1.4927, "lon": 103.7414 },
            "JHR02": { "name": "Kluang, Pontian", "state": "Johor", "lat": 2.0305, "lon": 103.3184 },
            "JHR03": { "name": "Batu Pahat, Muar, Segamat, Gemas Johor, Tangkak", "state": "Johor", "lat": 2.0442, "lon": 102.5660 },
            "KDH01": { "name": "Kota Setar, Kubang Pasu, Pokok Sena", "state": "Kedah", "lat": 6.1210, "lon": 100.3600 },
            "KDH02": { "name": "Pendang, Kuala Muda, Yan", "state": "Kedah", "lat": 5.7890, "lon": 100.4600 },
            "KDH03": { "name": "Padang Terap, Sik, Baling", "state": "Kedah", "lat": 5.7910, "lon": 100.7770 },
            "KDH04": { "name": "Kulim, Bandar Baharu", "state": "Kedah", "lat": 5.3650, "lon": 100.5610 },
            "KDH05": { "name": "Langkawi", "state": "Kedah", "lat": 6.3500, "lon": 99.8000 },
            "KTN01": { "name": "Kota Bharu, Bachok, Pasir Puteh, Machang, Pasir Mas, Tumpat, Kuala Krai", "state": "Kelantan", "lat": 6.1333, "lon": 102.2500 },
            "KTN02": { "name": "Gua Musang, Jeli", "state": "Kelantan", "lat": 4.8500, "lon": 101.9500 },
            "MLK01": { "name": "Seluruh Negeri Melaka", "state": "Melaka", "lat": 2.1896, "lon": 102.2501 },
            "NSN01": { "name": "Jelebu, Tampin, Jempol", "state": "Negeri Sembilan", "lat": 2.7300, "lon": 102.0800 },
            "NSN02": { "name": "Seremban, Port Dickson, Kuala Pilah, Rembau", "state": "Negeri Sembilan", "lat": 2.7297, "lon": 101.9381 },
            "PHG01": { "name": "Kuantan, Pekan, Rompin, Muadzam Shah", "state": "Pahang", "lat": 3.8077, "lon": 103.3260 },
            "PHG02": { "name": "Temerloh, Bera, Jerantut, Maran, Bentong, Raub, Lipis", "state": "Pahang", "lat": 3.4568, "lon": 102.3980 },
            "PHG03": { "name": "Genting Sempah, Janda Baik, Bukit Tinggi", "state": "Pahang", "lat": 3.4232, "lon": 101.7900 },
            "PHG04": { "name": "Cameron Highlands", "state": "Pahang", "lat": 4.4700, "lon": 101.3800 },
            "PRK01": { "name": "Tapah, Slim River, Tanjung Malim", "state": "Perak", "lat": 3.8500, "lon": 101.5000 },
            "PRK02": { "name": "Ipoh, Batu Gajah, Kampar, Sg. Siput, Kuala Kangsar", "state": "Perak", "lat": 4.5975, "lon": 101.0901 },
            "PRK03": { "name": "Pengkalan Hulu, Gerik, Lenggong", "state": "Perak", "lat": 5.4160, "lon": 101.1330 },
            "PRK04": { "name": "Temengor, Belum", "state": "Perak", "lat": 5.5920, "lon": 101.3090 },
            "PRK05": { "name": "Teluk Intan, Bagan Datuk, Kg. Gajah, Seri Iskandar, Parit", "state": "Perak", "lat": 4.0250, "lon": 100.9800 },
            "PRK06": { "name": "Lumut, Setiawan, Pulau Pangkor", "state": "Perak", "lat": 4.2100, "lon": 100.6300 },
            "PRK07": { "name": "Taiping, Bagan Serai, Parit Buntar", "state": "Perak", "lat": 4.8500, "lon": 100.7400 },
            "PLS01": { "name": "Seluruh Negeri Perlis", "state": "Perlis", "lat": 6.4440, "lon": 100.1960 },
            "PNG01": { "name": "Seluruh Negeri Pulau Pinang", "state": "Pulau Pinang", "lat": 5.4164, "lon": 100.3327 },
            "SBH01": { "name": "Kota Kinabalu, Ranau, Kota Belud, Tuaran, Penampang, Papar, Putatan", "state": "Sabah", "lat": 5.9804, "lon": 116.0735 },
            "SBH02": { "name": "Beaufort, Kuala Penyu, Sipitang, Tenom, Tambunan, Keningau", "state": "Sabah", "lat": 5.3433, "lon": 115.8500 },
            "SBH03": { "name": "Lahad Datu, Kunak, Semporna, Tawau", "state": "Sabah", "lat": 4.2449, "lon": 118.1100 },
            "SBH04": { "name": "Sandakan, Beluran, Kinabatangan", "state": "Sabah", "lat": 5.8402, "lon": 118.1170 },
            "SWK01": { "name": "Kuching, Samarahan, Serian", "state": "Sarawak", "lat": 1.5533, "lon": 110.3593 },
            "SWK02": { "name": "Sri Aman, Betong", "state": "Sarawak", "lat": 1.2400, "lon": 111.5000 },
            "SWK03": { "name": "Sibu, Mukah, Kapit", "state": "Sarawak", "lat": 2.2870, "lon": 111.8300 },
            "SWK04": { "name": "Bintulu, Miri, Limbang", "state": "Sarawak", "lat": 3.1660, "lon": 113.0330 }
        };

        let currentZone = "WLY01"; // Default to Kuala Lumpur

        const sampleHadith = [
            {
                id: 1,
                title: "Hadis tentang Senyuman",
                text: "ÿ™Ÿéÿ®Ÿéÿ≥ŸèŸëŸÖŸèŸÉŸé ŸÅŸêŸä ŸàŸéÿ¨ŸíŸáŸê ÿ£ŸéÿÆŸêŸäŸÉŸé ÿµŸéÿØŸéŸÇŸéÿ©Ÿå - Senyumanmu di hadapan saudaramu adalah sedekah.",
                source: "HR. Tirmidzi"
            },
            {
                id: 2,
                title: "Hadis tentang Ilmu",
                text: "ÿ∑ŸéŸÑŸéÿ®Ÿè ÿßŸÑŸíÿπŸêŸÑŸíŸÖŸê ŸÅŸéÿ±ŸêŸäÿ∂Ÿéÿ©Ÿå ÿπŸéŸÑŸéŸâ ŸÉŸèŸÑŸêŸë ŸÖŸèÿ≥ŸíŸÑŸêŸÖŸç - Menuntut ilmu itu wajib atas setiap Muslim.",
                source: "HR. Ibnu Majah"
            },
            {
                id: 3,
                title: "Hadis tentang Kebersihan",
                text: "ÿßŸÑŸÜŸéŸëÿ∏ŸéÿßŸÅŸéÿ©Ÿè ŸÖŸêŸÜŸé ÿßŸÑŸíÿ•ŸêŸäŸÖŸéÿßŸÜŸê - Kebersihan itu sebahagian daripada iman.",
                source: "HR. Muslim"
            },
            {
                id: 4,
                title: "Hadis tentang Sabar",
                text: "ÿßŸÑÿµŸéŸëÿ®Ÿíÿ±Ÿè ŸÖŸêŸÅŸíÿ™Ÿéÿßÿ≠Ÿè ÿßŸÑŸíŸÅŸéÿ±Ÿéÿ¨Ÿê - Sabar itu kunci kepada kelapangan.",
                source: "HR. Ahmad"
            },
            {
                id: 5,
                title: "Hadis tentang Rezeki",
                text: "ÿ•ŸêŸÜŸéŸë ÿßŸÑŸÑŸéŸëŸáŸé ŸäŸèÿ≠Ÿêÿ®ŸèŸë ÿ•Ÿêÿ∞Ÿéÿß ÿπŸéŸÖŸêŸÑŸé ÿ£Ÿéÿ≠ŸéÿØŸèŸÉŸèŸÖŸí ÿπŸéŸÖŸéŸÑŸãÿß ÿ£ŸéŸÜŸí ŸäŸèÿ™ŸíŸÇŸêŸÜŸéŸáŸè - Sesungguhnya Allah suka apabila seseorang melakukan sesuatu pekerjaan dengan itqan (sempurna).",
                source: "HR. Baihaqi"
            },
            {
                id: 6,
                title: "Hadis tentang Ikhlas",
                text: "ÿ•ŸêŸÜŸéŸëŸÖŸéÿß ÿßŸÑŸíÿ£ŸéÿπŸíŸÖŸéÿßŸÑŸè ÿ®ŸêÿßŸÑŸÜŸêŸëŸäŸéŸëÿßÿ™Ÿê - Sesungguhnya setiap amalan itu bergantung kepada niat.",
                source: "HR. Bukhari"
            },
            {
                id: 7,
                title: "Hadis tentang Persaudaraan",
                text: "ÿßŸÑŸíŸÖŸèÿ≥ŸíŸÑŸêŸÖŸè ÿ£ŸéÿÆŸèŸà ÿßŸÑŸíŸÖŸèÿ≥ŸíŸÑŸêŸÖŸê - Seorang Muslim itu saudara kepada Muslim yang lain.",
                source: "HR. Bukhari"
            },
            {
                id: 8,
                title: "Hadis tentang Taqwa",
                text: "ÿßÿ™ŸéŸëŸÇŸê ÿßŸÑŸÑŸéŸëŸáŸé ÿ≠ŸéŸäŸíÿ´ŸèŸÖŸéÿß ŸÉŸèŸÜŸíÿ™Ÿé - Bertaqwalah kepada Allah di mana sahaja kamu berada.",
                source: "HR. Tirmidzi"
            },
            {
                id: 9,
                title: "Hadis tentang Syukur",
                text: "ŸÖŸéŸÜŸí ŸÑŸéŸÖŸí ŸäŸéÿ¥ŸíŸÉŸèÿ±Ÿê ÿßŸÑŸÜŸéŸëÿßÿ≥Ÿé ŸÑŸéŸÖŸí ŸäŸéÿ¥ŸíŸÉŸèÿ±Ÿê ÿßŸÑŸÑŸéŸëŸáŸé - Barangsiapa tidak berterima kasih kepada manusia, maka dia tidak berterima kasih kepada Allah.",
                source: "HR. Abu Dawud"
            },
            {
                id: 10,
                title: "Hadis tentang Kasih Sayang",
                text: "ÿßŸÑÿ±ŸéŸëÿßÿ≠ŸêŸÖŸèŸàŸÜŸé ŸäŸéÿ±Ÿíÿ≠ŸéŸÖŸèŸáŸèŸÖŸè ÿßŸÑÿ±ŸéŸëÿ≠ŸíŸÖŸéŸÜŸè - Orang-orang yang penyayang akan disayangi oleh Allah Yang Maha Penyayang.",
                source: "HR. Tirmidzi"
            }
        ];

        const sampleDoa = [
            {
                id: 1,
                title: "Doa Pagi",
                arabic: "ÿ£ŸéÿµŸíÿ®Ÿéÿ≠ŸíŸÜŸéÿß ŸàŸéÿ£ŸéÿµŸíÿ®Ÿéÿ≠Ÿé ÿßŸÑŸíŸÖŸèŸÑŸíŸÉŸè ŸÑŸêŸÑŸéŸëŸáŸê",
                text: "Asbahna wa asbahal mulku lillah",
                meaning: "Kami berada di waktu pagi dan kerajaan Allah berada di waktu pagi."
            },
            {
                id: 2,
                title: "Doa Sebelum Makan",
                arabic: "ÿ®Ÿêÿ≥ŸíŸÖŸê ÿßŸÑŸÑŸéŸëŸáŸê ŸàŸéÿπŸéŸÑŸéŸâ ÿ®Ÿéÿ±ŸéŸÉŸéÿ©Ÿê ÿßŸÑŸÑŸéŸëŸáŸê",
                text: "Bismillahi wa 'ala barakatillah",
                meaning: "Dengan nama Allah dan atas keberkatan Allah."
            },
            {
                id: 3,
                title: "Doa Mohon Ampun",
                arabic: "ÿ£Ÿéÿ≥Ÿíÿ™Ÿéÿ∫ŸíŸÅŸêÿ±Ÿè ÿßŸÑŸÑŸéŸëŸáŸé ÿßŸÑŸíÿπŸéÿ∏ŸêŸäŸÖŸé",
                text: "Astaghfirullaha al-'azhim",
                meaning: "Aku memohon ampun kepada Allah Yang Maha Agung."
            },
            {
                id: 4,
                title: "Doa Petang",
                arabic: "ÿ£ŸéŸÖŸíÿ≥ŸéŸäŸíŸÜŸéÿß ŸàŸéÿ£ŸéŸÖŸíÿ≥ŸéŸâ ÿßŸÑŸíŸÖŸèŸÑŸíŸÉŸè ŸÑŸêŸÑŸéŸëŸáŸê",
                text: "Amsaina wa amsal mulku lillah",
                meaning: "Kami berada di waktu petang dan kerajaan Allah berada di waktu petang."
            },
            {
                id: 5,
                title: "Doa Selepas Makan",
                arabic: "ÿßŸÑŸíÿ≠ŸéŸÖŸíÿØŸè ŸÑŸêŸÑŸéŸëŸáŸê ÿßŸÑŸéŸëÿ∞ŸêŸä ÿ£Ÿéÿ∑ŸíÿπŸéŸÖŸéŸÜŸéÿß ŸàŸéÿ≥ŸéŸÇŸéÿßŸÜŸéÿß",
                text: "Alhamdu lillahil ladzi at'amana wa saqana",
                meaning: "Segala puji bagi Allah yang telah memberi makan dan minum kepada kami."
            },
            {
                id: 6,
                title: "Doa Keluar Rumah",
                arabic: "ÿ®Ÿêÿ≥ŸíŸÖŸê ÿßŸÑŸÑŸéŸëŸáŸê ÿ™ŸéŸàŸéŸÉŸéŸëŸÑŸíÿ™Ÿè ÿπŸéŸÑŸéŸâ ÿßŸÑŸÑŸéŸëŸáŸê",
                text: "Bismillahi tawakkaltu 'alallah",
                meaning: "Dengan nama Allah, aku bertawakal kepada Allah."
            },
            {
                id: 7,
                title: "Doa Masuk Rumah",
                arabic: "ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿ•ŸêŸÜŸêŸëŸä ÿ£Ÿéÿ≥Ÿíÿ£ŸéŸÑŸèŸÉŸé ÿÆŸéŸäŸíÿ±Ÿé ÿßŸÑŸíŸÖŸéŸàŸíŸÑŸêÿ¨Ÿê ŸàŸéÿÆŸéŸäŸíÿ±Ÿé ÿßŸÑŸíŸÖŸéÿÆŸíÿ±Ÿéÿ¨Ÿê",
                text: "Allahumma inni as'aluka khairal maulaji wa khairal makhraji",
                meaning: "Ya Allah, sesungguhnya aku memohon kepada-Mu kebaikan masuk dan kebaikan keluar."
            },
            {
                id: 8,
                title: "Doa Mohon Perlindungan",
                arabic: "ÿ£ŸéÿπŸèŸàÿ∞Ÿè ÿ®ŸêÿßŸÑŸÑŸéŸëŸáŸê ŸÖŸêŸÜŸé ÿßŸÑÿ¥ŸéŸëŸäŸíÿ∑ŸéÿßŸÜŸê ÿßŸÑÿ±ŸéŸëÿ¨ŸêŸäŸÖŸê",
                text: "A'udzu billahi minas syaitanir rajim",
                meaning: "Aku berlindung kepada Allah daripada syaitan yang direjam."
            },
            {
                id: 9,
                title: "Doa Mohon Keberkatan",
                arabic: "ÿ®Ÿéÿßÿ±ŸéŸÉŸé ÿßŸÑŸÑŸéŸëŸáŸè ŸÑŸéŸÜŸéÿß ŸÅŸêŸäŸÖŸéÿß ÿ±Ÿéÿ≤ŸéŸÇŸéŸÜŸéÿß",
                text: "Baraka Allahu lana fima razaqana",
                meaning: "Semoga Allah memberkati kami dalam apa yang telah direzekikan kepada kami."
            },
            {
                id: 10,
                title: "Doa Tidur",
                arabic: "ÿ®Ÿêÿßÿ≥ŸíŸÖŸêŸÉŸé ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿ£ŸéŸÖŸèŸàÿ™Ÿè ŸàŸéÿ£Ÿéÿ≠ŸíŸäŸéÿß",
                text: "Bismika Allahumma amutu wa ahya",
                meaning: "Dengan nama-Mu ya Allah, aku mati dan aku hidup."
            }
        ];

        const illustrationOptions = [
            {
                id: 1,
                title: "Masjid & Bulan Sabit",
                description: "Ilustrasi masjid dengan bulan sabit dan bintang, nuansa biru lembut dengan elemen awan"
            },
            {
                id: 2,
                title: "Kaligrafi & Geometrik",
                description: "Motif kaligrafi Arab dengan pola geometrik Islam, warna emas dan hijau emerald"
            },
            {
                id: 3,
                title: "Pemandangan Alam",
                description: "Pemandangan sunrise/sunset dengan siluet masjid, nuansa hangat orange dan ungu"
            }
        ];

        function getCurrentDateTime() {
            const now = new Date();
            const options = {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            };
            
            const dateStr = now.toLocaleDateString('ms-MY', options);
            const timeStr = now.toLocaleTimeString('ms-MY', { 
                hour: '2-digit', 
                minute: '2-digit',
                hour12: false 
            });
            
            return `${dateStr} - ${timeStr}`;
        }

        async function fetchPrayerTimes(zone) {
            try {
                const response = await fetch(`https://www.e-solat.gov.my/index.php?r=esolatApi/takwimsolat&period=today&zone=${zone}`);
                const data = await response.json();
                
                if (data.status === "OK!" && data.prayerTime && data.prayerTime.length > 0) {
                    const prayer = data.prayerTime[0];
                    return {
                        times: {
                            'Subuh': prayer.fajr,
                            'Syuruk': prayer.syuruk,
                            'Zohor': prayer.dhuhr,
                            'Asar': prayer.asr,
                            'Maghrib': prayer.maghrib,
                            'Isyak': prayer.isha
                        },
                        hijriDate: prayer.hijri,
                        date: prayer.date
                    };
                } else {
                    throw new Error('Invalid API response');
                }
            } catch (error) {
                console.error('Error fetching prayer times:', error);
                // Fallback to sample data if API fails
                return {
                    times: {
                        'Subuh': '05:45',
                        'Syuruk': '07:05',
                        'Zohor': '13:15',
                        'Asar': '16:30',
                        'Maghrib': '19:20',
                        'Isyak': '20:35'
                    },
                    hijriDate: getHijriDate(),
                    date: new Date().toLocaleDateString('en-CA')
                };
            }
        }

        function getHijriDate() {
            // Simple Hijri date calculation (fallback only)
            const gregorianDate = new Date();
            const hijriYear = Math.floor(((gregorianDate.getFullYear() - 622) * 365.25) / 354.36667) + 1;
            
            const hijriMonths = [
                'Muharram', 'Safar', 'Rabi\'ul Awwal', 'Rabi\'ul Akhir',
                'Jumadil Awwal', 'Jumadil Akhir', 'Rejab', 'Sya\'ban',
                'Ramadan', 'Syawal', 'Zulkaedah', 'Zulhijjah'
            ];
            
            // Approximate calculation
            const dayOfYear = Math.floor((gregorianDate - new Date(gregorianDate.getFullYear(), 0, 0)) / 86400000);
            const hijriMonth = Math.floor((dayOfYear * 12) / 354) % 12;
            const hijriDay = Math.floor(dayOfYear / 29.5) % 30 + 1;
            
            return `${hijriDay} ${hijriMonths[hijriMonth]} ${hijriYear}H`;
        }

        async function getAllData() {
            // Show loading
            document.getElementById('loading').style.display = 'block';
            
            try {
                // Get current location and prayer zone
                const locationData = await getCurrentLocation();
                currentZone = locationData.zone;
                currentData.location = locationData.location;
                
                // Get current datetime
                currentData.datetime = getCurrentDateTime();
                
                // Fetch real prayer times and hijri date from API
                const prayerData = await fetchPrayerTimes(currentZone);
                currentData.prayerTimes = prayerData.times;
                currentData.hijriDate = prayerData.hijriDate;
                
                // Display data
                document.getElementById('current-datetime').innerHTML = `
                    üìÖ ${currentData.datetime}<br>
                    üåô ${currentData.hijriDate}<br>
                    üìç ${currentData.location.name}, ${currentData.location.state}
                `;
                document.getElementById('current-datetime').classList.remove('hidden');
                
                displayPrayerTimes();
                displayRandomHadithChoices();
                displayRandomDoaChoices();
                displayIllustrationChoices();
                
                // Reset selections
                currentData.selectedHadith = null;
                currentData.selectedDoa = null;
                currentData.selectedIllustration = null;
                
                // Hide loading and show sections
                document.getElementById('loading').style.display = 'none';
                document.getElementById('prayer-section').classList.remove('hidden');
                document.getElementById('hadith-section').classList.remove('hidden');
                document.getElementById('doa-section').classList.remove('hidden');
                document.getElementById('illustration-section').classList.remove('hidden');
                document.getElementById('generate-section').classList.remove('hidden');
                
                // Hide prompt section for new data
                document.getElementById('prompt-section').classList.add('hidden');
                
            } catch (error) {
                console.error('Error getting data:', error);
                document.getElementById('loading').style.display = 'none';
                alert('Terdapat masalah mendapatkan data. Sila cuba lagi.');
            }
        }

        function displayPrayerTimes() {
            const container = document.getElementById('prayer-times');
            container.innerHTML = '';
            
            Object.entries(currentData.prayerTimes).forEach(([name, time]) => {
                const div = document.createElement('div');
                div.className = 'prayer-time';
                div.innerHTML = `
                    <div class="prayer-name">${name}</div>
                    <div class="prayer-time-value">${time}</div>
                `;
                container.appendChild(div);
            });
        }

        function displayRandomHadithChoices() {
            const container = document.getElementById('hadith-choices');
            container.innerHTML = '';
            
            // Get 3 random hadith
            const shuffled = [...sampleHadith].sort(() => 0.5 - Math.random());
            const randomHadith = shuffled.slice(0, 3);
            
            randomHadith.forEach((hadith, index) => {
                const div = document.createElement('div');
                div.className = 'choice-item';
                div.innerHTML = `
                    <label class="radio-label">
                        <input type="radio" name="hadith" value="${hadith.id}" class="radio-input" onchange="selectHadith(${hadith.id}, ${index})">
                        <div class="choice-content">
                            <div class="choice-title">${hadith.title}</div>
                            <div class="choice-text">${hadith.text}</div>
                            <div class="choice-text" style="font-style: italic; margin-top: 5px;">${hadith.source}</div>
                        </div>
                    </label>
                `;
                container.appendChild(div);
            });
            
            // Store current random hadith for later use
            window.currentRandomHadith = randomHadith;
        }

        function displayRandomDoaChoices() {
            const container = document.getElementById('doa-choices');
            container.innerHTML = '';
            
            // Get 3 random doa
            const shuffled = [...sampleDoa].sort(() => 0.5 - Math.random());
            const randomDoa = shuffled.slice(0, 3);
            
            randomDoa.forEach((doa, index) => {
                const div = document.createElement('div');
                div.className = 'choice-item';
                div.innerHTML = `
                    <label class="radio-label">
                        <input type="radio" name="doa" value="${doa.id}" class="radio-input" onchange="selectDoa(${doa.id}, ${index})">
                        <div class="choice-content">
                            <div class="choice-title">${doa.title}</div>
                            <div class="choice-text" style="font-family: serif; font-size: 1.1em; margin-bottom: 5px;">${doa.arabic}</div>
                            <div class="choice-text">${doa.text}</div>
                            <div class="choice-text" style="font-style: italic; margin-top: 5px;">${doa.meaning}</div>
                        </div>
                    </label>
                `;
                container.appendChild(div);
            });
            
            // Store current random doa for later use
            window.currentRandomDoa = randomDoa;
        }

        function displayIllustrationChoices() {
            const container = document.getElementById('illustration-choices');
            container.innerHTML = '';
            
            illustrationOptions.forEach(illustration => {
                const div = document.createElement('div');
                div.className = 'choice-item';
                div.innerHTML = `
                    <label class="radio-label">
                        <input type="radio" name="illustration" value="${illustration.id}" class="radio-input" onchange="selectIllustration(${illustration.id})">
                        <div class="choice-content">
                            <div class="choice-title">${illustration.title}</div>
                            <div class="choice-text">${illustration.description}</div>
                        </div>
                    </label>
                `;
                container.appendChild(div);
            });
        }

        function selectHadith(id, index) {
            currentData.selectedHadith = window.currentRandomHadith[index];
            updateChoiceSelection('hadith-choices', index + 1);
        }

        function selectDoa(id, index) {
            currentData.selectedDoa = window.currentRandomDoa[index];
            updateChoiceSelection('doa-choices', index + 1);
        }

        function selectIllustration(id) {
            currentData.selectedIllustration = illustrationOptions.find(i => i.id == id);
            updateChoiceSelection('illustration-choices', id);
        }

        function updateChoiceSelection(containerId, selectedId) {
            const container = document.getElementById(containerId);
            const items = container.querySelectorAll('.choice-item');
            
            items.forEach((item, index) => {
                if (index + 1 == selectedId) {
                    item.classList.add('selected');
                } else {
                    item.classList.remove('selected');
                }
            });
        }

        function generatePrompt() {
            if (!currentData.selectedHadith || !currentData.selectedDoa || !currentData.selectedIllustration) {
                alert('Sila pilih hadis, doa, dan ilustrasi terlebih dahulu!');
                return;
            }

            const prompt = `
‚Ä¢ Cipta poster islamik harian dengan maklumat berikut:

‚Ä¢ Tarikh Masehi: ${currentData.datetime}
‚Ä¢ Tarikh Hijriah: ${currentData.hijriDate}
‚Ä¢ Lokasi: ${currentData.location.name}, ${currentData.location.state}

‚Ä¢ Waktu Solat:
  - Subuh: ${currentData.prayerTimes.Subuh}
  - Syuruk: ${currentData.prayerTimes.Syuruk}  
  - Zohor: ${currentData.prayerTimes.Zohor}
  - Asar: ${currentData.prayerTimes.Asar}
  - Maghrib: ${currentData.prayerTimes.Maghrib}
  - Isyak: ${currentData.prayerTimes.Isyak}

‚Ä¢ Hadis Pilihan:
  - Tajuk: ${currentData.selectedHadith.title}
  - Teks: ${currentData.selectedHadith.text}
  - Sumber: ${currentData.selectedHadith.source}

‚Ä¢ Doa Pilihan:
  - Nama: ${currentData.selectedDoa.title}
  - Arab: ${currentData.selectedDoa.arabic}
  - Rumi: ${currentData.selectedDoa.text}
  - Maksud: ${currentData.selectedDoa.meaning}

‚Ä¢ Gaya Ilustrasi: ${currentData.selectedIllustration.description}

‚Ä¢ Spesifikasi Design:
  - Saiz: 1080x1080 (Instagram square)
  - Warna: Harmoni sesuai tema ilustrasi
  - Font: Readable dan profesional
  - Layout: Balanced dan mudah dibaca
  - Tulisan: Jelas dan kemas
  - Elemen: Include geometric patterns atau islamic motifs
  - Mood: Inspiring dan spiritual
  - Kedua-dua tarikh (Masehi & Hijriah) mesti dipaparkan dengan jelas`;

            document.getElementById('prompt-textarea').value = prompt.trim();
            document.getElementById('prompt-section').classList.remove('hidden');
        }

        function copyPrompt() {
            const textarea = document.getElementById('prompt-textarea');
            textarea.select();
            document.execCommand('copy');
            
            // Change button text temporarily
            const btn = event.target;
            const originalText = btn.innerHTML;
            btn.innerHTML = '‚úÖ Copied!';
            setTimeout(() => {
                btn.innerHTML = originalText;
            }, 2000);
        }

        function editPrompt() {
            const textarea = document.getElementById('prompt-textarea');
            textarea.focus();
            textarea.removeAttribute('readonly');
        }
		function findNearestZone(lat, lon) {
            let minDistance = Infinity;
            let nearestZone = "WLY01";
            
            Object.entries(prayerZones).forEach(([zoneCode, zoneData]) => {
                const distance = Math.sqrt(
                    Math.pow(lat - zoneData.lat, 2) + Math.pow(lon - zoneData.lon, 2)
                );
                
                if (distance < minDistance) {
                    minDistance = distance;
                    nearestZone = zoneCode;
                }
            });
            
            return nearestZone;
        }

        async function getCurrentLocation() {
            return new Promise((resolve) => {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(
                        (position) => {
                            const lat = position.coords.latitude;
                            const lon = position.coords.longitude;
                            const zone = findNearestZone(lat, lon);
                            resolve({ zone, location: prayerZones[zone] });
                        },
                        () => {
                            // If GPS fails, use default
                            resolve({ zone: "WLY01", location: prayerZones["WLY01"] });
                        },
                        { timeout: 5000 }
                    );
                } else {
                    resolve({ zone: "WLY01", location: prayerZones["WLY01"] });
                }
            });
        }
    </script>
</body>

</html>
